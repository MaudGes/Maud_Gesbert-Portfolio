{% extends "base.html" %}
{% block title %}Projet : Heart Disease{% endblock %}
{% block content %}
<h1>Projet : Prédiction des maladies cardiaques</h1>

<form method="post" action="/projects/heart_disease" onsubmit="return convertAge();">

  <!-- General Health -->
  <label>Quel est votre état de santé général ?
    <select name="GenHlth" required>
      <option value="1">1 - Excellente</option>
      <option value="2">2 - Bon</option>
      <option value="3">3 - Moyen</option>
      <option value="4">4 - Mauvais</option>
      <option value="5">5 - Très mauvais</option>
    </select>
  </label><br><br>

  <!-- Âge réel -->
  <label>Quel est votre âge ?
    <input type="number" id="real_age" min="18" max="120" required>
    <input type="hidden" name="Age" id="Age">
  </label><br><br>

  <!-- Binaire & catégoriques -->
  <label>Avez vous du déjà fait un AVC ?
    <select name="Stroke" required>
      <option value="0">0 - Non</option>
      <option value="1">1 - Oui</option>
    </select>
  </label><br><br>

  <label>Quel est votre sexe ?
    <select name="Sex" required>
      <option value="0">0 - Femme</option>
      <option value="1">1 - Homme</option>
    </select>
  </label><br><br>

  <label>Avez vous du un taux de cholestérol élevé ?
    <select name="HighChol" required>
      <option value="0">0 - Non</option>
      <option value="1">1 - Oui</option>
    </select>
  </label><br><br>

  <label>Avez vous du de l'hypertension ?
    <select name="HighBP" required>
      <option value="0">0 - Non</option>
      <option value="1">1 - Oui</option>
    </select>
  </label><br><br>

  <label>Avez vous du diabète ?
    <select name="Diabetes" required>
      <option value="0">0 - Non / Uniquement pendant grossesse </option>
      <option value="1">1 - Pré-diabète</option>
      <option value="2">2 - Oui</option>
    </select>
  </label><br><br>

  <!-- Santé physique -->
  <label>A combien estimeze vous le nombre de jours de mauvaise santé physique sur les 30 derniers jours ?
    <input type="number" name="PhysHlth" min="0" max="30" required>
  </label><br><br>

  <!-- IMC : menu déroulant 12 à 98 -->
  <label>Quel est votre IMC ?
    <select name="BMI" required>
      {% for i in range(12, 99) %}
        <option value="{{ i }}">{{ i }}</option>
      {% endfor %}
    </select>
  </label><br><br>

  <!-- Difficulté à marcher -->
  <label>Eprouvez-vous des difficultés à marcher ou à monter les escaliers ?
    <select name="DiffWalk" required>
      <option value="0">0 - No difficulty</option>
      <option value="1">1 - Has difficulty</option>
    </select>
  </label><br><br>

  <button type="submit" class="btn">Prédire</button>
</form>

{% if prediction is defined %}
  <h2>Résultat de la prédiction :</h2>
  <p>{{ prediction }}</p>
{% endif %}

<br><a href="/" class="btn">Retour à l'accueil</a>

<!-- JS : conversion âge réel vers classe d'âge -->
<script>
function convertAge() {
  const realAge = parseInt(document.getElementById('real_age').value);
  const ageField = document.getElementById('Age');

  if (realAge < 18 || realAge > 120) {
    alert("Veuillez entrer un âge entre 18 et 120.");
    return false;
  }

  const ageClass = Math.min(Math.floor((realAge - 18) / 5) + 1, 13);
  ageField.value = ageClass;
  return true;
}
</script>
{% endblock %}
