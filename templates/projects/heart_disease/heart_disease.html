{% extends "base.html" %}
{% block title %}Projet : Heart Disease{% endblock %}
{% block content %}
<h1>Possibilité de développer une maladie cardiaque, ou de faire une crise cardiaque</h1>

<p>
    <h3>Description</h3>
    Projet personnel basé sur un jeu de données du CDC (US Centers for Disease Control and Prevention),
    une agence américaine dédiée à la prévention des maladies, des blessures et des handicaps.<br>
    Les participants à cette étude sur les maladies cardiaques devaient répondre à des questions sur leur santé,
    et indiquer s'il avait déjà contracté une maladie cardio-vasculaire ou fait une crise cardiaque.
    En utilisant ces réponses, j'ai pu tester et créer un modèle de machine learning qui permet de prédire
    si une personne est à risque de développer une maladie cardiaque en se basant sur différents critères
    de santé.<br>

    Les questions ci-dessous reprennent les questions posées par le CDC lors de leur étude sur les maladies cardiaques.<br>

    N'hésitez pas à essayer !<br>

    NB : Pour respecter le cadre RGPD, les données que vous fournissez ne sont pas conservées, 
    elle sont automatiquement détruites lorsque la page est quittée ou rechargée.
</p>

<h3>Questions</h3>

<form method="post" action="/projects/heart_disease" onsubmit="return convertAge();">

  <!-- General Health -->
  <label><important-text>Comment estimez-vous votre état de santé général ?</important-text>
    <select name="GenHlth" required>
      <option value="1">1 - Excellent</option>
      <option value="2">2 - Bon</option>
      <option value="3">3 - Moyen</option>
      <option value="4">4 - Mauvais</option>
      <option value="5">5 - Très mauvais</option>
    </select>
  </label><br><br>

  <!-- Âge réel -->
  <label><important-text>Quel est votre âge ?</important-text>
    <input type="number" id="real_age" min="18" max="120" required>
    <input type="hidden" name="Age" id="Age">
  </label><br><br>

  <!-- Binaire & catégoriques -->
  <label><important-text>Avez-vous du déjà fait un AVC ?</important-text>
    <select name="Stroke" required>
      <option value="0">0 - Non</option>
      <option value="1">1 - Oui</option>
    </select>
  </label><br><br>

  <label><important-text>Quel est votre sexe ?</important-text>
    <select name="Sex" required>
      <option value="0">0 - Femme</option>
      <option value="1">1 - Homme</option>
    </select>
  </label><br><br>

  <label><important-text>Avez-vous un taux de cholestérol élevé ?</important-text>
    <select name="HighChol" required>
      <option value="0">0 - Non</option>
      <option value="1">1 - Oui</option>
    </select>
  </label><br><br>

  <label><important-text>Avez-vous de l'hypertension ?</important-text>
    <select name="HighBP" required>
      <option value="0">0 - Non</option>
      <option value="1">1 - Oui</option>
    </select>
  </label><br><br>

  <label><important-text>Avez-vous du diabète ?</important-text>
    <select name="Diabetes" required>
      <option value="0">0 - Non / Uniquement pendant grossesse </option>
      <option value="1">1 - Pré-diabète</option>
      <option value="2">2 - Oui</option>
    </select>
  </label><br><br>

  <!-- Santé physique -->
  <label><important-text>A combien estimez-vous le nombre de jours de mauvaise santé physique sur les 30 derniers jours ?</important-text>
    <input type="number" name="PhysHlth" min="0" max="30" required>
  </label><br><br>

  <!-- IMC : menu déroulant 12 à 98 -->
  <label><important-text>Quel est votre IMC ?</important-text>
    <select name="BMI" required>
      {% for i in range(12, 99) %}
        <option value="{{ i }}">{{ i }}</option>
      {% endfor %}
    </select>
  </label><br><br>

  <!-- Difficulté à marcher -->
  <label><important-text>Eprouvez-vous des difficultés à marcher ou à monter les escaliers ?</important-text>
    <select name="DiffWalk" required>
      <option value="0">0 - Non </option>
      <option value="1">1 - Oui</option>
    </select>
  </label><br><br>

  <button type="submit" class="btn">Prédire</button>
</form>

{% if prediction is defined %}
  <h2>Résultat de la prédiction :</h2>
  <p>{{ prediction }}</p>
{% endif %} <br>

<h3>Etapes de création du modèle :</h3>

<div id="pptCarousel" class="carousel slide mt-4" data-bs-ride="carousel" data-bs-interval="false">
  <!-- Indicators -->
  <div class="carousel-indicators">
    {% for idx in range(17) %}
      <button
        type="button"
        data-bs-target="#pptCarousel"
        data-bs-slide-to="{{ idx }}"
        {% if idx == 0 %}class="active" aria-current="true"{% endif %}
        aria-label="Slide {{ idx + 1 }}"
      ></button>
    {% endfor %}
  </div>

  <!-- Slides -->
  <div class="carousel-inner">
    {% for i in range(1, 18) %}
      <div class="carousel-item {% if i == 1 %}active{% endif %}">
        <img
          src="{{ url_for('static', filename='images/Maladie_Cardiaque_PPT/Diapositive' ~ i ~ '.jpeg') }}"
          class="d-block w-100"
          alt="Slide {{ i }}"
        >
      </div>
    {% endfor %}
  </div>

  <!-- Controls -->
  <button
    class="carousel-control-prev"
    type="button"
    data-bs-target="#pptCarousel"
    data-bs-slide="prev"
  >
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button
    class="carousel-control-next"
    type="button"
    data-bs-target="#pptCarousel"
    data-bs-slide="next"
  >
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<br><a href="/" class="btn">Retour à l'accueil</a>

<!-- JS : conversion âge réel vers classe d'âge -->
<script>
function convertAge() {
  const realAge = parseInt(document.getElementById('real_age').value);
  const ageField = document.getElementById('Age');

  if (realAge < 18 || realAge > 120) {
    alert("Veuillez entrer un âge entre 18 et 120.");
    return false;
  }

  const ageClass = Math.min(Math.floor((realAge - 18) / 5) + 1, 13);
  ageField.value = ageClass;
  return true;
}
</script>
{% endblock %}